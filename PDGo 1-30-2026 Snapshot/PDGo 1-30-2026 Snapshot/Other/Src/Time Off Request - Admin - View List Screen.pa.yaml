# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Time Off Request - Admin - View List Screen:
    Properties:
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
      OnVisible: |-
        =Clear(Subordinates);

        //ForAll(Filter('Users-Teams', UserID = UserRecord.ID),
         //   With({Sup: LookUp(Teams, ThisRecord.ID = TeamID).Supervisor, Team: TeamID}, With({SupervisorUser: LookUp(Users, Office365 =
         //       Office365Users.UserProfile(
         //           Last(Split(Last(Sup.Claims).Claims, "|")).Value
         //       ).Id)},
          //      If(SupervisorUser.ID = UserRecord.ID, ForAll(Filter('Users-Teams', TeamID = Team),
          //          Collect(Subordinates, LookUp(Users, ID = UserID))
          //      ))
          //  ))
        //);
        /*
        ForAll(Filter('Users-Teams', 'User ID' = UserRecord.ID),
            With({
                Team: LookUp(Teams, ID = 'Team ID')
            },
                With({
                    Supervisor: LookUp(Users, ID = Office365Users.UserProfile(
                        Last(Split(Last(Team.Supervisor.Claims).Claims, "|")).Value
                    ).Id)
                }, If(Supervisor.ID = UserRecord.ID, 
                    ForAll(Filter('Users-Teams', 'Team ID' = Team.ID),
                        Collect(Subordinates, LookUp(Users, ID = 'User ID'));
                    )
                ))
            );
        );
        */
        ForAll(Filter(Users,Team.Value = UserData.Team.Value) As subs, If(IsBlank(subs.Supervisor.Value),Collect(Subordinates,subs.ID)));


        Collect(Subordinates, UserRecord); // Add self as subordinate
        UpdateContext({SubIDs: With({
            SubordinateIDs: ForAll(Subordinates, ThisRecord.Value)
        },
            Filter(TimeOffRequests, Status.Value = "Pending", Requester in SubordinateIDs)
        )});
    Children:
      - TO Request List Screen Main:
          Control: GroupContainer@1.4.0
          Variant: AutoLayout
          Properties:
            Height: |
              =Parent.Height
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            Width: =Parent.Width
          Children:
            - TO Request List Screen Header:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  Fill: =fxTheme.Header.BGColor
                  FillPortions: =0
                  Height: =100
                  LayoutAlignItems: =LayoutAlignItems.Stretch
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                  LayoutMinHeight: =100
                  PaddingBottom: =20
                  PaddingLeft: =20
                  PaddingRight: =20
                  PaddingTop: =20
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                Children:
                  - TO Request List Screen Header Back:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        AlignInContainer: =AlignInContainer.Center
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Color: =fxTheme.Header.TextColor
                        Height: =fxTheme.Header.IconSize
                        Icon: =Icon.ArrowLeft
                        OnSelect: =Back(ScreenTransition.UnCoverRight);
                        Width: =fxTheme.Header.IconSize
                  - TO Request List Screen Header Text:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Color: =fxTheme.Header.TextColor
                        Font: =Font.Lato
                        Height: =40
                        LayoutMinHeight: =40
                        LayoutMinWidth: =150
                        Size: =20
                        Text: ="Time Off Requests"
                        Width: =250
                  - filter_icon:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        AlignInContainer: =AlignInContainer.Center
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Color: =fxTheme.Header.TextColor
                        Fill: =Color.Transparent
                        Height: =fxTheme.Header.IconSize
                        Icon: =Icon.Filter
                        OnSelect: |-
                          =UpdateContext({filter_visible: !filter_visible})
                        Width: =fxTheme.Header.IconSize
            - search_Container:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.Semibold
                  Fill: =RGBA(136, 160, 209, 1)
                  FillPortions: =0
                  Height: =190
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutGap: =4
                  LayoutMinHeight: =100
                  LayoutWrap: =true
                  PaddingBottom: =5
                  PaddingTop: =5
                  Visible: =filter_visible
                Children:
                  - search_icon:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Color: =fxTheme.Header.TextColor
                        Height: =45
                        Icon: =Icon.Search
                        OnSelect: =
                  - search_input:
                      Control: Classic/TextInput@2.3.2
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Default: =
                        DelayOutput: =
                        Font: =Font.'Open Sans'
                        Height: =40
                        HintText: ="Search"
                        HoverBorderColor: =RGBA(0, 18, 107, 1)
                        HoverFill: =RGBA(149, 149, 149, 1)
                        LayoutMinHeight: =40
                        LayoutMinWidth: =320
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingTop: =0
                        Size: =13
                        Width: |
                          =(Parent.Width-search_icon.Width)-4
                  - Status_Label:
                      Control: Label@2.5.1
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Color: =fxTheme.Header.TextColor
                        Font: =Font.'Open Sans'
                        Height: =40
                        LayoutMinHeight: =40
                        LayoutMinWidth: =150
                        Size: =15
                        Text: ="Status"
                        Width: =150
                  - Status_ComboBox:
                      Control: Classic/ComboBox@2.4.0
                      Properties:
                        AlignInContainer: =AlignInContainer.Start
                        BorderColor: =RGBA(0, 18, 107, 1)
                        ChevronBackground: =RGBA(56, 96, 178, 1)
                        ChevronFill: =RGBA(255, 255, 255, 1)
                        ChevronHoverBackground: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                        ChevronHoverFill: =RGBA(255, 255, 255, 1)
                        DefaultSelectedItems: =["Pending"]
                        DisplayFields: =["Value"]
                        Font: =Font.'Open Sans'
                        Height: =40
                        HoverFill: =RGBA(186, 202, 226, 1)
                        IsSearchable: =false
                        Items: =["Approved","Pending","Denied", "Cancelled"]
                        LayoutMinHeight: =40
                        LayoutMinWidth: =328
                        PaddingBottom: =5
                        PaddingLeft: =5
                        PaddingRight: =5
                        PaddingTop: =5
                        PressedColor: =RGBA(255, 255, 255, 1)
                        PressedFill: =RGBA(0, 18, 107, 1)
                        SearchFields: =["Value"]
                        SelectionColor: =RGBA(255, 255, 255, 1)
                        SelectionFill: =RGBA(56, 96, 178, 1)
                        Size: =13
                        Width: =(Parent.Width-Status_Label.Width)-4
                  - Date_Label:
                      Control: Label@2.5.1
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        Color: =fxTheme.Header.TextColor
                        Font: =Font.'Open Sans'
                        Height: =40
                        LayoutMinHeight: =40
                        LayoutMinWidth: =150
                        Size: =15
                        Text: ="Date"
                        Width: =150
                  - DatePicker1:
                      Control: Classic/DatePicker@2.6.0
                      Properties:
                        BorderColor: =RGBA(0, 18, 107, 1)
                        DefaultDate: |
                          =Today()
                        Font: =Font.'Open Sans'
                        Height: =40
                        IconBackground: =RGBA(56, 96, 178, 1)
                        IconFill: =RGBA(255, 255, 255, 1)
                        LayoutMinHeight: =40
                        LayoutMinWidth: =328
                        Size: =14
                        Width: =(Parent.Width-Date_Label.Width)-4
                  - reset:
                      Control: Classic/Button@2.2.0
                      Properties:
                        BorderColor: =ColorFade(Self.Fill, -15%)
                        Color: =RGBA(255, 255, 255, 1)
                        DisabledBorderColor: =RGBA(166, 166, 166, 1)
                        Fill: =RGBA(56, 96, 178, 1)
                        FillPortions: =1
                        Font: =Font.'Open Sans'
                        Height: =40
                        HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
                        HoverColor: =RGBA(255, 255, 255, 1)
                        HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
                        LayoutMinHeight: =40
                        LayoutMinWidth: =160
                        OnSelect: |-
                          =Reset(search_input);
                          Reset(Status_ComboBox);
                          Reset(DatePicker1);
                        PressedBorderColor: =Self.Fill
                        PressedColor: =Self.Fill
                        PressedFill: =Self.Color
                        Size: =15
                        Text: ="Reset"
                        Width: =160
            - TO Request List Screen Gallery:
                Control: Gallery@2.15.0
                Variant: Vertical
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  BorderColor: =RGBA(0, 18, 107, 1)
                  Height: =Parent.Height
                  Items: |-
                    =Search(With({
                        SubordinateIDs: ForAll(Subordinates, ThisRecord.Value),
                        Statuses: Status_ComboBox.SelectedItems,
                        StatusCode:"Pending"
                    },
                        Filter(TimeOffRequests, StatusCode in Statuses, Or("Time Off Requests" in ForAll(UserRecord.Capabilities, Value), Requester in SubordinateIDs))
                    ), search_input.Text, Comments)
                  LayoutMinWidth: =Parent.Width
                  OnSelect: |-
                    =Navigate('Open Request Screen', ScreenTransition.Cover, {ApproveRecord: ThisItem});
                  TemplatePadding: =20
                  TemplateSize: =150
                  Width: =Parent.Width
                Children:
                  - TO Request List Screen Gallery Columns:
                      Control: GroupContainer@1.4.0
                      Variant: AutoLayout
                      Properties:
                        BorderThickness: =0.5
                        DropShadow: =DropShadow.Semilight
                        Fill: =If(ThisItem.'Created By'.Email <> User().Email, RGBA(0,0,0,0.1), RGBA(0,0,0,0))
                        Height: =Parent.TemplateHeight
                        LayoutAlignItems: =LayoutAlignItems.Stretch
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =5
                        LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                        PaddingBottom: =10
                        PaddingLeft: =10
                        PaddingRight: =10
                        PaddingTop: =10
                        Width: =Parent.TemplateWidth
                      Children:
                        - TO Request List Screen Date Range Column:
                            Control: Label@2.5.1
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              FillPortions: =1
                              Font: =Font.Lato
                              Height: =40
                              LayoutMinHeight: =40
                              LayoutMinWidth: =60
                              OnSelect: =
                              Size: |-
                                =If('Time Off Request - Admin - View List Screen'.Size=1,12
                                ,15)
                              Text: |-
                                =With({
                                    format: If('Time Off Request - Admin - View List Screen'.Size = 1, "dd mmm", "dd mmm yy")
                                },
                                    Text(Min(Filter(TimeOffRequestDays, Request = ThisItem.ID), StartDate), format)
                                    & "-
                                " &
                                    Text(Max(Filter(TimeOffRequestDays, Request = ThisItem.ID), EndDate), format)
                                )
                              Width: =Parent.Width*.20
                        - Container3_5:
                            Control: GroupContainer@1.4.0
                            Variant: AutoLayout
                            Properties:
                              DropShadow: =DropShadow.None
                              FillPortions: =3
                              Height: =200
                              LayoutAlignItems: =LayoutAlignItems.Stretch
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutJustifyContent: =LayoutJustifyContent.Center
                              LayoutMinHeight: =80
                              LayoutMinWidth: =120
                            Children:
                              - TO Request List Screen Requestor Column:
                                  Control: Label@2.5.1
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.Lato
                                    Height: =40
                                    LayoutMinHeight: =40
                                    LayoutMinWidth: =120
                                    OnSelect: =
                                    Size: =If('Time Off Request - Admin - View List Screen'.Size=1,10.24,13)
                                    Text: |-
                                      =//ThisItem.'Created By'.DisplayName
                                      If(ThisItem.Requester = 0, "User Missing or Error",LookUp(Users,ID = ThisItem.Requester).'Full Name')
                                    Width: =Parent.Width*.20
                              - TO Request List Screen Last Modified Column:
                                  Control: Label@2.5.1
                                  Properties:
                                    Align: =Align.Center
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.Lato
                                    Height: =40
                                    LayoutMinHeight: =40
                                    LayoutMinWidth: =Parent.Width*.20
                                    OnSelect: =
                                    Size: =If('Time Off Request - Admin - View List Screen'.Size=1,8.24,13)
                                    Text: |-
                                      ="Last Modified: " & Text(ThisItem.Modified, DateTimeFormat.ShortDate)
                                    Width: =Parent.Width*.20
                              - HtmlText1:
                                  Control: HtmlViewer@2.1.0
                                  Properties:
                                    FillPortions: =1
                                    Font: =Font.'Open Sans'
                                    Height: =40
                                    HtmlText: ="<center>" & ThisItem.Reason & "</center>"
                                    LayoutMinHeight: =40
                                    LayoutMinWidth: =100
                                    Size: =13
                                    Visible: =!IsBlank(PlainText(Self.HtmlText))
                                    Width: =200
                        - Container4_7:
                            Control: GroupContainer@1.4.0
                            Variant: AutoLayout
                            Properties:
                              DropShadow: =DropShadow.None
                              Height: =200
                              LayoutAlignItems: =LayoutAlignItems.Stretch
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutJustifyContent: =LayoutJustifyContent.Center
                              LayoutMinHeight: =100
                              LayoutMinWidth: =80
                            Children:
                              - TO Request List Screen Status Column:
                                  Control: Label@2.5.1
                                  Properties:
                                    Align: =Align.Center
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Color: |-
                                      =Switch(ThisItem.Status.Value,
                                          "Pending", RGBA(0, 0, 255, 1),
                                          "Cancelled", RGBA(0, 0, 0, 1),
                                          "Denied", RGBA(200, 0, 0, 1),
                                          "Approved", RGBA(0, 200, 100, 1),
                                          RGBA(0,0,0,1)
                                      )
                                    Font: =Font.Lato
                                    Height: =40
                                    LayoutMinHeight: =40
                                    LayoutMinWidth: =60
                                    OnSelect: =
                                    Size: =If('Time Off Request - Admin - View List Screen'.Size=1,10.24,13)
                                    Text: =ThisItem.Status.Value
                                    Width: =Parent.Width*.20
                              - Label4_4:
                                  Control: Label@2.5.1
                                  Properties:
                                    Align: =Align.Center
                                    AutoHeight: =true
                                    BorderColor: =RGBA(0, 18, 107, 1)
                                    Font: =Font.'Open Sans'
                                    Height: =40
                                    LayoutMinHeight: =40
                                    LayoutMinWidth: =80
                                    Size: =13
                                    Text: =Concat(Filter(TimeOffRequestDays, ThisItem.ID = Request), Reason, ", ")
                                    Width: =150
                        - Icon4_1:
                            Control: Classic/Icon@2.5.0
                            Properties:
                              BorderColor: =RGBA(0, 18, 107, 1)
                              Color: =RGBA(0, 18, 107, 1)
                              FillPortions: =1
                              Icon: =Icon.NextArrow
                              OnSelect: |-
                                =Navigate('Open Request Screen', ScreenTransition.Cover, {ApproveRecord: ThisItem});
                              PaddingBottom: =20
                              PaddingLeft: =20
                              PaddingRight: =20
                              PaddingTop: =20
                              Width: =100
